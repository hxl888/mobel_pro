$(function(){function t(t){var i=null,o=this;this.moveFn=function(){var i=t.find("li").eq(0);i.slideUp("slow",function(){i.show(),t.append(i)})},this.loopFn=function(){t.find("li").length>10&&t.hover(function(){clearInterval(i)},function(){clearInterval(i),i=setInterval(function(){o.moveFn()},4e3)}).trigger("mouseleave")}}function i(t,i){function o(){var t=$(window).width();t>=1400?l.init():$(".flSiderNav").hide()}var l=new e({dz:t,ele:"#g-fresh",codearrs:i}),a=$(window).width();a>=1400&&l.init(),window.onscroll=window.onresize=$.throttle(o,100)}var o={imgPath:$("#imgPath").val(),apiPath:$("#apiPath").val()},e=function(t){var i={dz:!1,ele:null,codearrs:null};this.settings=$.extend(!0,i,t),this.showArr=this.settings.codearrs,this.conTop=$(this.settings.ele).offset().top,this.t=null,this.navHtmlStr={888:'<li><div><i class="u-icon">&#xe644;</i>冻品专区</div></li>',7:'<li><div><i class="u-icon">&#xe645;</i>优质商家</div></li>',9:'<li class="clearfix"><div class="tcdiv"><i class="u-icon">&#xe646;</i><p>肉禽<br>蛋类</p></div><div class="tcdiv"><i class="u-icon">&#xe635;</i><p>速冻<br>食品</p></div></li>',10:'<li class="clearfix"><div class="tcdiv"><i class="u-icon">&#xe647;</i><p>海鲜<br>水产</p></div><div class="tcdiv"><i class="u-icon">&#xe64a;</i><p>进口<br>食品</p></div></li>',11:'<li class="clearfix twoCol"><div class="tcdiv"><i class="u-icon">&#xe669;</i><p>酒水<br>饮品</p></div><div class="tcdiv"><i class="u-icon">&#xe649;</i><p>粮油<br>副食</p></div></li>',12:'<li><div><i class="u-icon">&#xe618;</i>冷链物流</div></li>',13:'<li><div><i class="u-icon">&#xe64b;</i>鲜易金融</div></li>',14:'<li><div><i class="u-icon">&#xe64c;</i>资讯行情</div></li>'},this.settings.dz&&this.showArr.unshift(888)};e.prototype={init:function(){this.renderDom(),this.resetPos(),this.smoothFn(),this.scrtFn()},renderDom:function(){if(!($(".flSiderNav").length>0)){for(var t='<div class="flSiderNav"><ul>',i=0;i<this.showArr.length;i++)t+=this.navHtmlStr[this.showArr[i]];t+="</ul></div>",$("body").append(t)}},resetPos:function(){var t=($(window).width()-1200)/2-87;$(".flSiderNav").css({left:t})},objLength:function(){for(var t=this,i=[],o=[],e=0;e<t.showArr.length;e++)o.push($(".g-floor[data-code="+t.showArr[e]+"]").attr("id")),i.push(parseInt($(".g-floor[data-code="+t.showArr[e]+"]").offset().top)-10);return{dis:i,objs:o}},scrollTab:function(){for(var t=this.objLength(),i=t.dis,o=t.objs,e=$(window).scrollTop(),l=i.length-1;l>=0;l--){if(e>=$("#"+o[l]).offset().top-100){$(".flSiderNav li").eq(l).addClass("active").siblings().removeClass("active");break}$(".flSiderNav li").removeClass("active")}},smoothFn:function(){var t=this.objLength(),i=t.dis;$(".flSiderNav li").off("click.smooth"),$(".flSiderNav li").on("click.smooth",function(){var t=$(this);if(!t.hasClass("active")){var o=$(".flSiderNav li").index(this),e=i[o];$("html,body").stop().animate({scrollTop:e+"px"},300)}})},scrtFn:function(){var t=this,i=$(window).scrollTop();i>t.conTop?$(".flSiderNav").show(0,function(){$(".flSiderNav").css({"-webkit-transform":"scale(1)","-moz-transform":"scale(1)",transform:"scale(1)",opacity:"1"})}):($(".flSiderNav").css({"-webkit-transform":"scale(1.2)","-moz-transform":"scale(1.2)",transform:"scale(1.2)",opacity:"0"}),clearTimeout(t.t),t.t=setTimeout(function(){$(".flSiderNav").hide()},30)),t.scrollTab()}};var l=function(){};l.prototype.init=function(t){var i=this;if(!$(t).hasClass("floor-loading")){$(t).addClass("floor-loading");var o=$(t).attr("data-code");"3"===o?(this.ajaxNet(o,$(t),function(o){i.loadSlider(t,o)}),this.ajaxNet("4",$(t),function(o){i.loadLookFor(t,o)}),(new Date).getHours()>=12?$(".vs-uwl").html("HI下午好！"):"",this.loadProCount(),this.loadDaiNum()):"5"===o?this.ajaxNet(o,$(t),function(o){i.loadNewPro(t,o)}):"6"===o?this.ajaxNet(o,$(t),function(o){i.loadCmsg(t,o)}):"7"===o?this.ajaxNet(o,$(t),function(o){i.loadShops(t,o)}):"8"===o||"200"===o||"201"===o||"202"===o?this.ajaxNet(o,$(t),function(o){o.floorDateInfo.one.length?i.loadAds(t,o):$(".g-floor-"+o.floorDateInfo.menuCode).remove()}):"9"===o||"10"===o||"11"===o?this.ajaxNet(o,$(t),function(o){i.loadCategory(t,o)}):"12"===o?this.ajaxNet(o,$(t),function(o){i.loadLenglian(t,o)}):"13"===o?this.ajaxNet(o,$(t),function(o){i.loadFinance(t,o)}):"14"===o&&this.ajaxNet(o,$(t),function(o){i.loadNews(t,o)})}},l.prototype.ajaxNet=function(t,i,o){var e=this;e.url=$("#apiPath").val()+"/cms/dataInfo/floorDate.shtml";$.ajax({url:e.url,type:"get",dataType:"jsonp",timeout:8e3,data:{menuCode:t}}).done(function(t){$(i).removeClass("floor-loading").addClass("floor-lazy-done"),o&&o(t)}).fail(function(t){})},l.prototype.loadSlider=function(t,i){var e=i.floorDateInfo.one,l=template("f-slider",{list:e,pathConfig:o});$("#g-fl01-slider").html(l),$("#g-fl01-slider").slide({titCell:"#g-fl01-stit ul",mainCell:"#g-fl01-spic ul",effect:"leftLoop",autoPlay:!0,autoPage:!0,interTime:5e3,delayTime:300,vis:1,switchLoad:"_src"})},l.prototype.loadLookFor=function(t,i){var e=i.floorDateInfo.one,l='<ul class="clearfix"><%for(var i=0;i<list.length;i++) {%><li><a href="<%=list[i].picLinkHttp%>" target="_blank"><img src="<%=pathConfig.imgPath + list[i].picUrl%>" width="44" height="44" alt="<%=list[i].picDesc%>"><p><%=list[i].picDesc%></p></a></li><%}%></ul>',a=template.compile(l),n=a({list:e,pathConfig:o});$(".vm-msg3").html(n).removeClass("page-loading02")},l.prototype.loadDaiNum=function(){var t=cookieJS.getCookie("_xea")&&cookieJS.getCookie("xe_login_name");t&&($(".vm-msg2").find(".vm-msg2-nl").hide(),$(".vm-msg2").find(".vm-msg2-ld").addClass("page-loading02").show(),$.ajax({url:$("#apiPath").val()+"/cms/dataInfo/queryOrderCount.shtml",type:"GET",dataType:"jsonp"}).done(function(t){"0000"===t.resultCode&&($("#df01").html(t.waitPayCount),$("#df02").html(t.waitReceiveCount),$("#df03").html(t.waitCommentCount),$(".vm-msg2").find(".vm-msg2-ld").removeClass("page-loading02").find("li").show())}).fail(function(){$(".vm-msg2").find(".vm-msg2-ld").show().html("加载失败,请重新刷新！")}))},l.prototype.loadProCount=function(i,o){template.helper("proCountfomate",function(t,i){t+="";var o=[];o.length=i,t.length<i&&(t=(o.join(0)+t).slice(-i));for(var e=/(?=(?!\b)(\d{3})+$)/g,l=t.replace(e,",").split(""),a="",n=0;n<l.length;n++)a+=","===l[n]?"<em>,</em>":"<span>"+l[n]+"</span>";return a});var e=this;e.url=$("#apiPath").val()+"/cms/dataInfo/queryTodayQuotation.shtml",$.ajax({url:e.url,type:"get",dataType:"jsonp",timeout:8e3}).done(function(i){$(".vm-msg4").removeClass("page-loading02");var o='<ul><li style="display:block"><%=#proCountfomate(proCount,9)%></li><li><%=#proCountfomate(verdorCount,9)%></li><li><%=#proCountfomate(purchaserNum,9)%></li></ul>',e='<h5>今日成交量</h5><ul class="msg4-ul"><%for(var i=0;i<list.length;i++) {%><li><em><%=list[i].LOGINACCOUNT%></em><span>成交&nbsp;<i class="f-rmb">&yen;<%=toFixed(list[i].PAYAMOUT)%></i></span></li><%}%></ul>',l=template.compile(o),a=l({proCount:i.productCount,verdorCount:i.vendorCount,purchaserNum:i.purchaserNum});if(i.doneInfoList.length>0)var n=template.compile(e),s=n({list:i.doneInfoList});$("#msg4-tc").html(a),$("#msg4-mlp").html(s),new t($(".msg4-ul")).loopFn(),$(".msg4-b").css({width:$(".msg4-tab span").eq(0).outerWidth()}),$("body").on("click",".msg4-tab span",function(t){var i=$(".msg4-tab span").index(this),o=$(".msg4-b"),e=$(this).position().left,l=$(this).outerWidth();o.stop(!0).animate({left:e,width:l},300),$("#msg4-tc li").hide().eq(i).show()})}).fail(function(t){})},l.prototype.loadNewPro=function(t,i){var e=i.floorDateInfo.one,l=i.floorDateInfo.two,a=template("f-fresh",{list1:e,list2:l,pathConfig:o});$("#g-fresh").html(a)},l.prototype.loadCmsg=function(t,i){var e=i.floorDateInfo.one,l=i.floorDateInfo.two,a=i.floorDateInfo.three,n=i.floorDateInfo.four,s=template("f-cmsg",{list1:e,list2:l,list3:a,list4:n,pathConfig:o});$("#g-f02").html(s)},l.prototype.loadShops=function(t,i){var e=i.floorDateInfo.menuTitle,l=i.floorDateInfo.one,a=i.floorDateInfo.two,n=template("f-shops",{listDataTit:e,list1:l,list2:a,pathConfig:o});$("#g-f04").html(n),$(".g-shops-left").slide({titCell:".g-shops-tips ul",mainCell:".g-shops-con ul",effect:"leftLoop",autoPlay:!0,autoPage:!0,interTime:5e3,delayTime:300,switchLoad:"_src"}),$(".g-shops-item li").on("mouseover",function(t){$(this).find(".g-sib").stop(!0).animate({top:0},300)}).on("mouseout",function(t){$(this).find(".g-sib").stop(!0).animate({top:130},300)})},l.prototype.loadAds=function(t,i){var e=i.floorDateInfo.one;if(e){var l='<%for(var i=0;i<list.length;i++) {%><%if(list.length <= 1) {%><a href="<%=list[i].picLinkHttp%>"><img src="<%=pathConfig.imgPath + list[i].picUrl%>" width="1200" height="100" alt="<%=list[i].picDesc%>"><%}else{%><%if(i==0){%><a class="fl" href="<%=list[i].picLinkHttp%>"><%}else{%><a class="fr" href="<%=list[i].picLinkHttp%>"><%}%><img src="<%=pathConfig.imgPath + list[i].picUrl%>" width="593" height="100" alt="<%=list[i].picDesc%>"><%}%></a><%}%>',a=template.compile(l),n=a({list:e,pathConfig:o});$(t).html(n)}else $(t).hide()},l.prototype.loadCategory=function(t,i){var e=$(t).attr("data-code"),l=i.floorDateInfo,a=template("f-category",{list:l,pathConfig:o});$(".g-floor-"+e).html(a)},l.prototype.loadLenglian=function(t,i){if(i.floorDateInfo){var e=i.floorDateInfo,l=template("f-lenglian",{list:e,pathConfig:o});$("#g-f08").html(l),$("#g-f08").on("click",".mj-adr-tab span",function(t){t.preventDefault();var i=$(".mj-adr-tab span").index(this),o=$(this).width(),e=$(this).position().left;$(this).siblings().removeClass("active").end().addClass("active"),$(".mj-adr-tab").find("em").stop(!0).animate({width:o,left:e},300),$(".mj-adr-tabcons").hide().eq(i).show()}),$(".mj-adr-tabcons").find(".selectfns").selectfns(),$(".mjAdrdd").adrSelects({fn:function(t){},position:"left",cookieFlag:!1})}},l.prototype.loadFinance=function(t,i){if(i.floorDateInfo){var e=i.floorDateInfo,l=template("f-finance",{list:e,pathConfig:o});$("#g-f09").html(l)}},l.prototype.loadNews=function(i,e){if(e.floorDateInfo){var l=e.floorDateInfo,a=template("f-news",{list1:l.one,list2:l.two,list3:l.three,list4:l.four,list5:l.five,pathConfig:o});$("#g-f10").html(a),new t($(".quoUl")).loopFn()}};var a=new l,n=function(t){var o=this;o.url=$("#apiPath").val()+"/index/indexJsonp/jsonp/getBulkProductList.shtml";$.ajax({url:o.url,type:"get",dataType:"jsonp",timeout:8e3,data:{cityId:$.cookie("cyCityId")?$.cookie("cyCityId"):""}}).done(function(e){e.bulkProductList.length?(o.init(e.bulkProductList),i(!0,t)):($("#g-f03").remove(),i(!1,t)),$.scrollShow(".g-floor",function(t){a.init(t)})}).fail(function(o){$.scrollShow(".g-floor",function(t){a.init(t)}),i(!1,t)})};n.prototype.init=function(t){var i=template("f-blukMsg",{list:t,pathConfig:o});$("#g-f03").html(i)},$.ajax({url:$("#apiPath").val()+"/cms/dataInfo/menuCodeList.shtml",type:"get",dataType:"jsonp"}).done(function(t){var i=t.forbidden.forbiddenCodeList,o=t.menucodeList,e=[];if(i.length)for(var l=0;l<i.length;l++)$(".g-floor-"+i[l]).remove();for(var s=0;s<o.length;s++)1==o[s].hovering&&e.push(o[s].menuCode);new n(e),$(window).on("scroll resize",function(){$.scrollShow(".g-floor",function(t){a.init(t)})})}).fail(function(){})});