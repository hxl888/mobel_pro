$(function(){function a(a){var e="";return e+='<ol class="clearfix bulkLi bulkLi1">',e+='<li><p><i><span class="rmb">&yen;</span>'+t(a.price)+'/<b class="f14">'+a.units+"</b></i> ",e+='<i class="small" title="'+a.newPrice+'">'+a.newPrice+"</i></li></ol>"}function e(a,e){var i="";if(e)var s=a.productPresaleLadder;else var s=a.productLadder;var r=s.length;if(i+='<ol class="clearfix bulkLi bulkLi'+r+'">',2==r)for(var o=0;o<r;o++)i+='<li><p><i><span class="rmb">&yen;</span>'+t(s[o].ladderPrice)+"</i>",i+='<i class="small" title="'+s[o].initialNumber+"-"+s[o].endNumber+a.units+'">'+s[o].initialNumber+"-"+s[o].endNumber+a.units+"</i> </p></li>";else for(var o=0;o<r;o++){if(o==r-1){i+='<li><p><i><span class="rmb">&yen;</span>'+t(s[o].ladderPrice)+"</i>",i+='<i class="small" title="&ge;'+s[o].initialNumber+a.units+'">&ge;'+s[o].initialNumber+a.units+"</i> </p></li>";break}i+='<li><p><i><span class="rmb">&yen;</span>'+t(s[o].ladderPrice)+"</i>",i+='<i class="small" title="'+s[o].initialNumber+"-"+s[o].endNumber+a.units+'">'+s[o].initialNumber+"-"+s[o].endNumber+a.units+"</i> </p></li>"}return i+="</ol>"}function t(a){return a=parseFloat(a).toFixed(2)}function i(a){return a>1e4?a=parseFloat(a/1e4).toFixed(1)+"万":a,a}function s(a,e){for(var t='<ul class="cyMarList cyMarList'+a+'">',i=0;i<e.length&&!(i>=5);i++)t+="<li>",t+='    <p class="Mar_pic"><a target="_blank" href="'+m+e[i].productCode+'.shtml"><img src="'+c+"product/200/200/"+e[i].mainImgUrl+'" alt="" width="220" height="220"></a></p>',t+='    <p class="Mar_des"><a target="_blank" href="'+m+e[i].productCode+'.shtml">'+e[i].productName+"</a></p>",t+='    <p class="Mar_price">',t+=1==e[i].pricingType?'    <span class="f16"><i class="rmb">&yen;</i>'+e[i].newPrice+"/kg</span>":'    <span class="f16"><i class="rmb">&yen;</i>'+e[i].price+"/"+e[i].units+"</span>",t+="        <span>"+e[i].newPrice+"/kg</span>",t+="    </p>",t+="</li>";return t+="</ul>"}function r(){function a(){var a=$(window).scrollTop();a>i&&s>a?$(".fsFixedTopContent").show("fast",function(){$(".fsFixedTop").css({"-webkit-transform":"scale(1)","-moz-transform":"scale(1)",transform:"scale(1)",opacity:"1"})}).css({visibility:"visible"}):($(".fsFixedTop").css({"-webkit-transform":"scale(1.2)","-moz-transform":"scale(1.2)",transform:"scale(1.2)",opacity:"0"}),$(".fsFixedTopContent").css({visibility:"hidden"})),t.scrollTab()}var e=!-[1]&&!window.XMLHttpRequest,t=this;if(this.arrLength=function(){for(var a=[],e=0;e<$(".floor").length;e++)a.push(parseInt($(".floor").eq(e).offset().top)+10);return a},this.scrollTab=function(){for(var a=$(".floor"),e=$(window).scrollTop(),t=a.length-1;t>=0;t--){if(e>=$(a[t]).offset().top-150){$(".fsFixedTop p.smooth").eq(t).addClass("active").siblings().removeClass("active"),$(a[t]).find(".xet").addClass("current");break}$(".fsFixedTop p.smooth").removeClass("active"),$(".floor").find(".xet").removeClass("current")}},this.smoothFn=function(){var a=t.arrLength();$(".fsFixedTop p.smooth").on("click",function(){var e=$(this),t=$(".fsFixedTop p.smooth").index(this),i=a[t];$("html,body").stop().animate({scrollTop:i+"px"},300),e.addClass("active").siblings().removeClass("active")})},jQuery.support.boxSizing&&!e){var i=$(".floor").eq(0).offset().top,s=$(".floor:last").offset().top,r=null;$(window).scroll(function(){clearTimeout(r),r=setTimeout(a,100)}),t.smoothFn(),$(".backTotop").click(function(){$("html,body").stop().animate({scrollTop:0},400)})}}var o=cookieJS.getCookie("cyCityId")?cookieJS.getCookie("cyCityId"):"2",l=cookieJS.getCookie("userGrade")?cookieJS.getCookie("userGrade"):"",n=$("#apiPath").val()+"/index/indexJsonp/jsonp/getBulkProductList.shtml",c=$("#imgPath").val();$("#apiPath").val();$.ajax({url:$("#apiPath").val()+"/cms/dataInfo/floorDate.shtml",type:"POST",dataType:"jsonp",data:{menuCode:20,cityId:o},success:function(a){for(var e="",t=a.floorDateInfo[0],i=0;i<t.length;i++)e+='<li style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%; overflow: hidden; display: list-item; background-image: url('+c+t[i].picUrl+'); background-color: #ffe739;">',e+='<a href="'+t[i].picLinkHttp+'" target="_blank"></a></li>';$(".bannerWrap").html(e),HtmlSlidePlayer({autosize:0,fontsize:12,time:4e3})}});var d=1;$(".ajax-floor").each(function(){var a=$(this).attr("data-code");if($(this).hasClass("ajax-floor-false"))return $(this).remove(),$(".floor-smooth"+a).remove(),!0;$(this).find(".xet").addClass("xet_0"+d),$(this).find("i.inflr").html(d+"F"),d++;var e=$(this);$.ajax({url:$("#apiPath").val()+"/cms/dataInfo/floorDate.shtml",type:"POST",dataType:"jsonp",data:{menuCode:a,cityId:o},success:function(a){var t=a.floorDateInfo,i="";i+='<div class="xec_main">';for(var s=0;s<t[1].length;s++)i+='<div class="xec_m">',i+='<a href="'+$("#itemPath").val()+t[1][s].prodCode+'.shtml" target="_blank">',i+='<img class="lazy" src="'+$("#basePath").val()+'/images/lazyPic.png" data-original="'+c+t[1][s].picUrl+'" width="200" height="255" alt="商品图片">',i+='<span class="top-tip01" title="'+t[1][s].productName+'">'+t[1][s].productName,i+="</span>",i+=t[1][s].vipPrice?'<span class="topBok">&yen;'+t[1][s].vipPrice.toFixed(2)+"/"+t[1][s].units+"<em>"+t[1][s].unitPrice+"/kg</em></span>":'<span class="topBok">&yen;'+t[1][s].prodPrice.toFixed(2)+"/"+t[1][s].units+"<em>"+t[1][s].unitPrice+"/kg</em></span>",i+="</a>",i+='<a href="'+$("#itemPath").val()+t[2][s].prodCode+'.shtml" target="_blank" class="xec-mDown">',i+='<img class="lazy" src="'+$("#basePath").val()+'/images/lazyPic.png" data-original="'+c+t[2][s].picUrl+'" width="200" height="165" alt="商品图片">',i+='<span class="top-tip01" title="'+t[2][s].productName+'">'+t[2][s].productName,i+="</span>",i+=t[2][s].vipPrice?'<span class="topBok">&yen;'+t[2][s].vipPrice.toFixed(2)+"/"+t[2][s].units+"<em>"+t[2][s].unitPrice+"/kg</em></span>":'<span class="topBok">&yen;'+t[2][s].prodPrice.toFixed(2)+"/"+t[2][s].units+"<em>"+t[2][s].unitPrice+"/kg</em></span>",i+="</a>",i+="</div>";i+="</div>",i+='<div class="xec_left">',i+='<a href="'+$("#itemPath").val()+t[0][0].prodCode+'.shtml" target="_blank">',i+='<img class="lazy" src="'+$("#basePath").val()+'/images/lazyPic.png" data-original="'+c+t[0][0].picUrl+'" width="355" height="420" alt="">',i+=" <span>&yen;"+t[0][0].prodPrice.toFixed(2)+"/"+t[0][0].units+"<em>"+t[0][0].unitPrice+"/kg</em></span>",i+="</a>",i+="</div>",i+='<div class="xec_right">',i+='<div class="rankList">',i+='<h6 class="rankTit">本周热销排行榜TOP3</h6>',i+='<div class="rankPro">',i+='<ul class="rankUl clearfix">';for(var r=0;r<t[4].length;r++)i+='<li class="clearfix">',i+='<a href="'+$("#itemPath").val()+t[4][r].prodCode+'.shtml" target="_blank">',i+='<img class="lazy" src="'+$("#basePath").val()+'/images/lazyPic.png" data-original="'+c+t[4][r].picUrl+'" width="47" height="47" alt="">',i+='<div class="rankItem">',i+="<h5>"+t[4][r].productName+"</h5>",i+="<p>&yen;"+t[4][r].prodPrice.toFixed(2)+"/"+t[4][r].units+"</p>",i+="</div>",i+="</a>",i+="</li>";i+="</ul>",i+="</div>",i+="</div>",i+='<div class="brandList">',i+='<a href="'+$("#itemPath").val()+t[3][0].prodCode+'.shtml" target="_blank">',i+='<span class="starPro01" title="'+t[3][0].productName+'">'+t[3][0].productName+"</span>",i+='<img src="'+c+t[3][0].picUrl+'" height="150" width="246">',i+=t[3][0].vipPrice?"<span>&yen;"+t[3][0].vipPrice.toFixed(2)+"/"+t[3][0].units+"<em>"+t[3][0].unitPrice+"/kg</em></span>":"<span>&yen;"+t[3][0].prodPrice.toFixed(2)+"/"+t[3][0].units+"<em>"+t[3][0].unitPrice+"/kg</em></span>",i+="</a>",i+="</div>",i+="</div>",e.find(".xec_foor_con").html(i),e.find("img.lazy").lazyLoadIndex()}})});var p=$("#itemPath").val();$.ajax({url:n,type:"GET",dataType:"jsonp",data:{cityId:o},timeout:5e3,success:function(t){var s=t.bulkProductList;if(5==s.length){for(var o="",l=0;l<s.length;l++)o+='<li class="bulkulLi"><p class="bulkPic">',o+='<a href="'+p+s[l].productCode+'.shtml" target="_blank"><img src="'+c+"/product/210/210/"+s[l].imgurl+'" alt="" width="220" height="220"></a></p>',o+=1==s[l].isEablePresaleLabber?e(s[l],!0):1==s[l].isPresale?a(s[l]):1==s[l].isEableLabber?e(s[l],!1):a(s[l]),o+='<p class="bulkDes ellipsis">'+s[l].productName+"</p>",o+='<p class="bulkLabel"><i>生鲜自营</i> <span>起订量: '+s[l].areaMinorderQuantity+"</span> <span>销量: "+i(s[l].totalSaleStr)+"</span></p></li>";$(".bulkUl").html(o),$("#bulkProList").attr("href",$("#apiPath").val()+"/index/indexJsonp/jsonp/getBulkProList.shtml"),$(".smoothBulk").stop().fadeIn(300),$(".dzfloor .hide").removeClass("hide")}else $(".dzfloor,.smoothBulk").remove();r()},error:function(a){$(".dzfloor,.smoothBulk").remove(),r()}});var m=$("#itemPath").val(),u=$("#apiPath").val()+"index/indexJsonp/jsonp/getCateGoryList.shtml",h=$(".cyMarket_thme"),f=$('<div class="cyMarListBox"></div>'),v="";$.ajax({url:u,type:"GET",dataType:"jsonp",data:{cid:"",cityId:o,gradeId:l},timeout:5e3,success:function(a){var e=a.recommendList;if(v+='<div class="floorSel">',0==e.length)return $(".floorlist").remove(),$(".smoothTheme").remove(),r(),!1;$(".floorlist .xe").fadeIn("300");for(var t=0;t<e.length;t++)v+='<a href="javascript:;" data-categoryId='+e[t].categoryId+">"+e[t].categoryName+"</a>";v+="</div>",h.append(v),$(".floorSel a:first").addClass("active").attr("data-loaded",!0),f.html(s(e[0].categoryId,e[0].queyrForList)),f.appendTo(h),r()}}),$("body").on("click",".floorSel a",function(){var a=$(this);$(this).addClass("active").siblings().removeClass("active"),$(".cyMarList").hide(),$(".cyerror").hide(),f.addClass("cybg-loading");var e=$(this).attr("data-categoryid");return $(this).attr("data-loaded")?(f.removeClass("cybg-loading"),void $(".cyMarList"+e).show()):void $.ajax({url:$("#apiPath").val()+"index/indexJsonp/jsonp/getCateGoryProductList.shtml",type:"GET",dataType:"jsonp",data:{cid:e,cityId:o,gradeId:l},timeout:5e3,success:function(t){if(!$(".cyMarList"+e).length){if(!t.queyrForList)return f.removeClass("cybg-loading"),$(".cyerror").length||$('<p class="cyerror"><span>网络异常，</span><a href="javascript:;" class="s-red" data-id="'+e+'">点击重新加载。</a></p>').appendTo(".cyMarListBox"),$(".cyerror").show(),void $(".cyMarList").hide();f.append(s(e,t.queyrForList))}f.removeClass("cybg-loading"),$(".cyMarList"+e).show(),a.attr("data-loaded",!0)},error:function(){f.removeClass("cybg-loading"),$(".cyerror").length||$('<p class="cyerror"><span>网络异常，</span><a href="javascript:;" class="s-red" data-id="'+e+'">点击重新加载。</a></p>').appendTo(".cyMarListBox"),$(".cyerror").show(),$(".cyMarList").hide()}})}),$("body").on("click",".cyerror a",function(){$(".floorSel a.active").click()}),dataUrl=$("#h_cartPath").val()+"cart/qca.shtml",$.ajax({url:dataUrl,type:"GET",dataType:"jsonp",timeout:5e3,success:function(a){$(".buyCart em").html(a.cartNum)}})});